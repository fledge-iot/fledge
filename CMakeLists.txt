cmake_minimum_required (VERSION 2.8.8)
project (FogLAMP)

option(BUILD_C_PLUGINS "Build C++ Plugins" ON)

set(CMAKE_CXX_FLAGS "-std=c++11 -O3")

add_subdirectory(C/common)
add_subdirectory(C/services/common)
add_subdirectory(C/plugins/common)
add_subdirectory(C/services/storage)
add_subdirectory(C/plugins/storage/common)
add_subdirectory(C/plugins/storage/postgres)
add_subdirectory(C/plugins/storage/sqlite)
add_subdirectory(C/plugins/storage/sqlitememory)
add_subdirectory(C/services/south)
add_subdirectory(C/tasks/north)
if (BUILD_C_PLUGINS)
	add_subdirectory(C/plugins/south/dummy)
	find_library(WiringPi wiringPi)
	if (WiringPi)
		add_subdirectory(C/plugins/south/ina219)
		add_subdirectory(C/plugins/south/dht11)
	endif()
	find_library(Modbus modbus)
	if (Modbus)
		add_subdirectory(C/plugins/south/modbus)
	endif()
	find_library(FREEOPCUA opcuaclient PATHS ~/freeopcua/build/lib)
	if (FREEOPCUA)
		add_subdirectory(C/plugins/south/opcua)
	endif()
	add_subdirectory(C/plugins/north/PI_Server)
	add_subdirectory(C/plugins/north/ThingSpeak)
	add_subdirectory(C/plugins/north/http-north)
	add_subdirectory(C/plugins/filter/scale)
	# Add Python 2.7 filter
	find_library(FoundPython_2.7 NAMES python2.7 python27)
	if (FoundPython_2.7)
		add_subdirectory(C/plugins/filter/python27)
	endif()
endif (BUILD_C_PLUGINS)
add_subdirectory(C/plugins/utils)
